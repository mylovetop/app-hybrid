/*! p2p 2015-01-16 */
angular.module(Constant.CONTROLLER).controller(Constant.CTRL_LOGIN,["$scope","$rootScope","$routeParams",Constant.SERVICE_USER,function(a,b,c,d){Common.setRouteTopBarBack(c.routeTopBarBack),a.topBar={titleLeft:"登录",route:Constant.ROUTE_LOGIN,titleRight:""},a.userName="",a.password="",a.userNameShow=!1,a.passwordShow=!1,a.$watch("userName",function(b){a.userNameShow=b.length>0?!0:!1}),a.$watch("password",function(b){a.passwordShow=b.length>0?!0:!1}),a.clearNameClick=function(){a.userName=""},a.clearPasswordClick=function(){a.password=""},a.cssTip="tip-hide",a.error="",a.submit=function(){return e(),Common.isOnLine()?0==a.userName.length?void g(2):0==a.password.length?void g(3):void f():void g(4)};var e=function(){document.querySelector("#id_password").blur(),document.querySelector("#id_userName").blur()},f=function(){d.login({userName:a.userName,password:a.password}).success(function(b){var c=JSON.parse(JSON.parse(b));1==c.status?(Common.setLocalStorage(Constant.KEY_USER,JSON.stringify(c.user)),Common.setLogin(1),g(0),a.back(Constant.ROUTE_MEMBER)):(g(1),Common.setLogin(0))}).error(function(){g(1)})},g=function(b){if(b){var c=a.dTip.count+1;a.cssTip="tip",h(1==b?{message:Constant.ERROR_LOGIN,cssTip:"tip",count:c}:2==b?{message:Constant.ERROR_LOGIN_USER_NAME,cssTip:"tip",count:c}:3==b?{message:Constant.ERROR_LOGIN_PASSWORD,cssTip:"tip",count:c}:{message:Constant.ERROR_NET_WORK,cssTip:"tip",count:c})}else h({message:"",cssTip:"",count:0})},h=function(b){a.dTip={message:b.message,cssTip:b.cssTip,count:b.count}};h({message:"",cssTip:"",count:0})}]);
/*! p2p 最后修改于： 2015-01-16 */