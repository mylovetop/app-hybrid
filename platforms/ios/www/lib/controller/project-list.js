/*! p2p 2015-01-16 */
angular.module(Constant.CONTROLLER).controller(Constant.CTRL_PROJECT_LIST,["$scope","$rootScope",Constant.SERVICE_PROJECT,Constant.SERVICE_USER,function(a,b,c,d){var e,f=0;a.isLoading=!0,a.projectList=[];var g=function(){c.query({dataNumOld:a.dataNumOld,dataNumNew:a.dataNumNew,pageIndex:a.pageIndex}).success(function(b){setTimeout(function(){var c=JSON.parse(JSON.parse(b));a.dataNumOld=c.dataNumOld,a.dataNumNew=c.dataNumNew,a.pageIndex=c.pageIndex,a.anchor=c.anchor,a.projectList=a.projectList.concat(c.projectList),a.isLoading=!1,a.$apply(),Common.hasIScroll()&&setTimeout(function(){0==f?(e=Common.initIScroll(i,j),f++):e.refresh()},300)},300)}).error(function(){a.dataNumOld=1,a.dataNumNew=1,a.pageIndex=1,a.anchor=0,a.projectList=[],a.isLoading=!1})};setTimeout(function(){g()},300);var h=function(){a.isLoading=!0,a.dataNumOld=1,a.dataNumNew=1,a.pageIndex=0,a.anchor=0,c.query({dataNumOld:a.dataNumOld,dataNumNew:a.dataNumNew,pageIndex:a.pageIndex}).success(function(b){var c=JSON.parse(JSON.parse(b));a.dataNumOld=c.dataNumOld,a.dataNumNew=c.dataNumNew,a.pageIndex=c.pageIndex,a.anchor=c.anchor,a.projectList=c.projectList,a.isLoading=!1,setTimeout(function(){null!=e&&e.refresh()},300)}).error(function(){a.dataNumOld=1,a.dataNumNew=1,a.pageIndex=1,a.anchor=0,a.projectList=[],a.isLoading=!1})};a.refreshProjectList=function(){h()},a.goDetailClick=function(b){var c=Common.getParamsFromProject(b,Constant.ROUTE_PROJECT_LIST);a.go(Constant.ROUTE_PROJECT_DETAIL+c)},window.onscroll=function(){if(Common.getScrollTop()+Common.getWindowHeight()==Common.getScrollHeight()){var b=a.dataNumNew,c=a.dataNumOld;if(c!=b){var d=a.pageIndex;a.pageIndex=d+1,a.dataNumOld=a.dataNumNew,g()}}},window.onload=function(){var b=a.anchor;0!=b&&(location.hash=b)};var i=function(){if(this.y-this.maxScrollY<300){var b=a.dataNumNew,c=a.dataNumOld;if(c!=b){var d=a.pageIndex;a.pageIndex=d+1,a.dataNumOld=a.dataNumNew,g()}}0==this.y&&h()};a.showPullRefreshCss=" pull-refresh-none";var j=function(){var b="";b=Common.ios7()?" pull-refresh-top-ios7":" pull-refresh-top",this.y>50&&(a.showPullRefreshCss="pull-refresh-show"+b,a.$apply()),this.y<50&&(a.showPullRefreshCss="pull-refresh-hide"+b,a.$apply())};a.isLogin=function(){d.isLogin().success(function(b){var c=JSON.parse(b);if(Common.setLogin(c),c-0)a.go(Constant.ROUTE_MEMBER);else{var d=Common.getParamsFromProject({},Constant.ROUTE_PROJECT_LIST);a.go(Constant.ROUTE_LOGIN+d)}}).error(function(){Common.setLogin("0")})}}]);
/*! p2p 最后修改于： 2015-01-16 */